<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>无标题文档</title>
<link href="css/style.css" rel="stylesheet" type="text/css" />
</head>

<body>

	<div class="place">
		<span>位置：</span>
		<ul class="placeul">
			<li><a href="#">基础信息管理</a></li>
			<li><a href="#">楼宇环境基础信息管理</a></li>
		</ul>
	</div>

	<div class="formbody">

		<div class="formtitle">
			<span>基本信息</span>
		</div>

		<table class="infotable" border="1" cellspacing="0" cellpadding="0">
			<tr>
			<input type="hidden" id="editid"></input>
				<input type="hidden" id="lyid"></input>
				<td><input type="button" class="btn btn-info" value="选择楼宇"
					onclick="showLYGrid()"></input></td>
				<td id="lyname" colspan="5"></td>

			</tr>
			<tr style="background: #ccc; height: 40px;">
				<td style="width: 5%">序号</td>
				<td style="width: 30%">设施环境</td>
				<td style="width: 15%">单位</td>
				<td style="width: 15%">数量</td>
				<td style="width: 35%">备注</td>
			</tr>
			<tr>
				<td>1</td>
				<td>500米内地铁站</td>
				<td>个</td>
				<td><input id="subway" type="number" class="dfinput"
					style="width: 99%" oninput="if(value.length>2)value=value.slice(0,2)"/></td>
				<td></td>
			</tr>
			<tr>
				<td>2</td>
				<td>200米内公交车</td>
				<td>趟</td>
				<td><input id="station" type="number" class="dfinput"
					style="width: 99%"  oninput="if(value.length>2)value=value.slice(0,2)"/></td>
				<td>指路牌数</td>
			</tr>
			<tr>
				<td>3</td>
				<td>200米内公共停车场每小时收费</td>
				<td>元／小时</td>
				<td><input id="stopprice" type="text" class="dfinput"
					style="width: 99%" maxlength="5"/></td>
				<td></td>
			</tr>
			<tr>
				<td>4</td>
				<td>200米内公共停车场车位数</td>
				<td>个</td>
				<td><input id="stopno" type="number" class="dfinput"
					style="width: 99%"  oninput="if(value.length>4)value=value.slice(0,4)"/></td>
				<td></td>
			</tr>
			<tr>
				<td>5</td>
				<td>楼内停车位数</td>
				<td>个</td>
				<td><input id="buildstop" type="number" class="dfinput"
					style="width: 99%"  oninput="if(value.length>4)value=value.slice(0,4)"/></td>
				<td></td>
			</tr>
			<tr>
				<td>6</td>
				<td>500米内快餐厅</td>
				<td>个</td>
				<td><input id="restaurant" type="number" class="dfinput"
					style="width: 99%"  oninput="if(value.length>4)value=value.slice(0,4)"/></td>
				<td></td>
			</tr>
			<tr>
				<td>7</td>
				<td>1000米内快捷酒店</td>
				<td>座</td>
				<td><input id="hotel1" type="number" class="dfinput"
					style="width: 99%" oninput="if(value.length>4)value=value.slice(0,4)"/></td>
				<td></td>
			</tr>
			<tr>
				<td>8</td>
				<td>1000米内三星以上宾馆</td>
				<td>座</td>
				<td><input id="hotel2" type="number" class="dfinput"
					style="width: 99%" oninput="if(value.length>4)value=value.slice(0,4)"/></td>
				<td></td>
			</tr>
			<tr>
				<td>9</td>
				<td>楼宇高速电梯</td>
				<td>部</td>
				<td><input id="hlift" type="number" class="dfinput"
					style="width: 99%" oninput="if(value.length>2)value=value.slice(0,2)"/></td>
				<td>指速度大于20米／秒</td>
			</tr>
			<tr>
				<td>10</td>
				<td>楼宇中速电梯</td>
				<td>部</td>
				<td><input id="mlift" type="number" class="dfinput"
					style="width: 99%" oninput="if(value.length>2)value=value.slice(0,2)"/></td>
				<td></td>
			</tr>
			<tr>
				<td>11</td>
				<td>楼宇专用货梯</td>
				<td>部</td>
				<td><input id="lift" type="number" class="dfinput"
					style="width: 99%" oninput="if(value.length>2)value=value.slice(0,2)"/></td>
				<td>非客货两用梯</td>
			</tr>
			<tr>
				<td>12</td>
				<td>楼宇内职工餐厅</td>
				<td>个</td>
				<td><input id="workerrestaurant" type="number" class="dfinput"
					style="width: 99%" oninput="if(value.length>2)value=value.slice(0,2)"/></td>
				<td></td>
			</tr>
			<tr>
				<td>13</td>
				<td>楼宇绿化率</td>
				<td>%</td>
				<td><input id="afforest" type="text" class="dfinput"
					style="width: 99%" maxlength="10"/></td>
				<td></td>
			</tr>
			<tr>
				<td>14</td>
				<td>200米内银行网点数</td>
				<td>个</td>
				<td><input id="bankno" type="number" class="dfinput"
					style="width: 99%" oninput="if(value.length>2)value=value.slice(0,2)"/></td>
				<td></td>
			</tr>
			<tr>
				<td>15</td>
				<td>200米内商务中心</td>
				<td>个</td>
				<td><input id="cbd" type="number" class="dfinput"
					style="width: 99%" oninput="if(value.length>2)value=value.slice(0,2)"/></td>
				<td></td>
			</tr>
			<tr>
				<td>16</td>
				<td>2000米内著名商圈</td>
				<td>个</td>
				<td><input id="cbdarea" type="number" class="dfinput"
					style="width: 99%" oninput="if(value.length>2)value=value.slice(0,2)"/></td>
				<td></td>
			</tr>
		</table>
		<br>
			<div style="text-align: center;">
				<input id="submitBtn" type="button" class="btn btn-info" value="提交" />
			</div>
	</div>
</body>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script>
	var url = window.location + "";
	var id = "";
	if(url.indexOf("?id=") >= 0){
		id = url.substring(url.indexOf("?id=") + 4, url.length);
	}
	if (id != null && id != "") {
		$.get("../build_environment/info", {
			id : id
		}, function(json) {
			$("#editid").prop('value', id);
			$("#subway").prop('value', json.data[0].subway);
			$("#station").prop('value', json.data[0].station);
			$("#stopprice").prop('value', json.data[0].stopprice);
			$("#stopno").prop('value', json.data[0].stopno);
			$("#buildstop").prop('value', json.data[0].buildstop);
			$("#restaurant").prop('value', json.data[0].restaurant);
			$("#hotel1").prop('value', json.data[0].hotel1);
			$("#hotel2").prop('value', json.data[0].hotel2);
			$("#hlift").prop('value', json.data[0].hlift);
			$("#mlift").prop('value', json.data[0].mlift);
			$("#lift").prop('value', json.data[0].lift);
			$("#afforest").prop('value', json.data[0].afforest);
			$("#bankno").prop('value', json.data[0].bankno);
			$("#cbd").prop('value', json.data[0].cbd);
			$("#cbdarea").prop('value', json.data[0].cbdarea);
			$("#lyid").prop('value', json.data[0].buildid);
			$("#workerrestaurant").prop('value', json.data[0].workerrestaurant);
			$("#lyname").empty().append(json.data[0].buildname);
		});
	}

	//var value = window.showModalDialog('lygrid.html','选择楼宇','dialogWidth:1000px;dialogHeight:600px; dialogLeft:200px;dialogTop:150px;center:yes;help:yes;resizable:yes;status:yes');
	function showLYGrid() {
		var iWidth = 1000;
	    var iHeight = 600;
	    var iTop = (window.screen.availHeight - 30 - iHeight) / 2;
	    var iLeft = (window.screen.availWidth - 10 - iWidth) / 2;
	    var win = window.open("lygrid.html", "弹出窗口", "width=" + iWidth + ", height=" + iHeight + ",top=" + iTop + ",left=" + iLeft);
	}

	function transferValue(value){
		var ly = value.split(",");
		$("#lyid").prop("value", ly[0]);
		$("#lyname").empty().append(ly[1]);
	}
	
	$('#submitBtn').click(function() {
		var id = $('#editid').val();
		var lyid = $("#lyid").val();
		if(lyid == null || lyid == ''){
			alert("请选择所在楼宇");
			return;
		}
		if (id == null || id == "") {
			$.post("../build_environment/add", {
				subway : $("#subway").val(),
				station : $("#station").val(),
				stopprice : $("#stopprice").val(),
				stopno : $("#stopno").val(),
				buildstop : $("#buildstop").val(),
				restaurant : $("#restaurant").val(),
				hotel1 : $("#hotel1").val(),
				hotel2 : $("#hotel2").val(),
				hlift : $("#hlift").val(),
				mlift : $("#mlift").val(),
				lift : $("#lift").val(),
				afforest : $("#afforest").val(),
				bankno : $("#bankno").val(),
				cbd : $("#cbd").val(),
				cbdarea : $("#cbdarea").val(),
				buildid : $("#lyid").val(),
				workerrestaurant : $('#workerrestaurant').val()
			}, function(json) {
				alert("添加成功！");
				window.history.go(-1);
			});
		}else{
			$.post("../build_environment/edit", {
				subway : $("#subway").val(),
				id : id,
				station : $("#station").val(),
				stopprice : $("#stopprice").val(), //find("option:selected").text(),
				stopno : $("#stopno").val(),
				buildstop : $("#buildstop").val(),
				restaurant : $("#restaurant").val(),
				hotel1 : $("#hotel1").val(),
				hotel2 : $("#hotel2").val(),
				hlift : $("#hlift").val(),
				mlift : $("#mlift").val(),
				lift : $("#lift").val(),
				afforest : $("#afforest").val(),
				bankno : $("#bankno").val(),
				cbd : $("#cbd").val(),
				cbdarea : $("#cbdarea").val(),
				buildid : $("#lyid").val(),
				workerrestaurant : $('#workerrestaurant').val()
			}, function(json) {
				alert("修改成功！");
				window.history.go(-1);
			});
		}
	});
</script>
</html>
