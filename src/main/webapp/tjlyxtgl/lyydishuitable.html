<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>无标题文档</title>
<link href="css/style.css" rel="stylesheet" type="text/css" />

<link rel="stylesheet" href="js/bootstrap/css/bootstrap.css">
	<link rel="stylesheet" href="js/mmgrid/mmGrid.css">
		<link rel="stylesheet"
			href="js/mmgrid/theme/bootstrap/mmGrid-bootstrap.css">
			<link rel="stylesheet" href="js/mmgrid/mmPaginator.css">
				<link rel="stylesheet"
					href="js/mmgrid/theme/bootstrap/mmPaginator-bootstrap.css">
					<link rel="stylesheet" href="css/jquery.monthpicker.css">
<style type="text/css">     
    .mask {       
            position: absolute; top: 0px; filter: alpha(opacity=60); background-color: #777;     
            z-index: 1002; left: 0px;     
            opacity:0.5; -moz-opacity:0.5;     
        }     
</style>  
</head>


<body>

	<div class="place">
		<span>位置：</span>
		<ul class="placeul">
			<li><a href="#">数据汇总</a></li>
			<li><a href="#">企业数据汇总</a></li>
		</ul>
	</div>

	<div class="rightinfo">

		<ul class="seachform">

			
			<li><input id="imgfile" type="file"  /></li>
			
			
			<li><label>数据日期</label><input id="s_reportdate" type="text"
				class="scinput" readonly="readonly"/></li>

			<li><label>&nbsp;</label><input name=""
				type="button" class="btn btn-info" value="导入地税数据" onclick="importdata()" /></li>
		
		</ul>
		
		<ul class="seachform" style="margin-top:100px;">
 			<li><label style="color:red;">导入完某月所有数据后需要转换成系统的数据</label></li>
              <li><label>转换数据月份</label><input id="ppreportdate" type="text"
				class="scinput" readonly="readonly"/></li>
       <li><label>&nbsp;</label><input name=""
				type="button" class="btn btn-info" value="地税数据转换" onclick="dodibatch()"/></li>
		
		</ul>
       </div>
      
<div id="mask" class="mask" style="height: 100%;width: 100%;min-width: 980px;     min-height: 720px;" >
   <div style="margin-top: 70px;margin: auto;  width: 100px;height: 100px;">
     <div style="margin-top: 200px;">
       <img src="./images/dengdai.gif" style="height: auto;
         max-width: 100%;
          vertical-align: middle;
          border: 0;" />
     </div>
  
   </div>
</div>  
</body>
<script type="text/javascript" src="js/jquery.min.js"></script>
<script src="js/mmgrid/mmGrid.js"></script>
<script src="js/mmgrid/mmPaginator.js"></script>
<script src="js/jquery.monthpicker.js"></script>
<script>
$("#mask").hide();
$('#s_reportdate').monthpicker({
	years :  [2015,2016,2017, 2018, 2019, 2020, 2021, 2022, 2023,2024,2025],
	topOffset : 6
})

$('#ppreportdate').monthpicker({
	years :  [2015,2016,2017, 2018, 2019, 2020, 2021, 2022, 2023,2024,2025],
	topOffset : 6
})






function importdata() {
	var datatime= $("#s_reportdate").val();
	if(datatime==""){
		alert("请选择要导入的数据日期");
	}else{
	if($("#imgfile")==""){
		alert("请选择要导入文件");
	}
	showMask(); 
	var formData = new FormData();
	formData.append("updishuifile",$("#imgfile")[0].files[0]);
	formData.append("datatime",datatime);
	$.ajax({ 
		url : "../build_imExport/uploaddishui.do", 
		type : 'POST', 
		data : formData, 
		// 告诉jQuery不要去处理发送的数据
		processData : false, 
		// 告诉jQuery不要去设置Content-Type请求头
		contentType : false,
		beforeSend:function(){
		console.log("正在进行，请稍候");
		},
		success : function(data) { 
		if(data=='result'){
			hideMask(); 
		alert("导入成功");
		cannel();
		}else{
			hideMask(); 
			alert("本月数据已经统计完成，禁止导入");
			cannel();
		}
		}, 
		error : function(responseStr) { 
			hideMask(); 
			alert("导入失败");
			cannel();
		} 
		});

	}
	
}
function  dodibatch(){
	
	var datatime= $("#ppreportdate").val();
	if(datatime==""){
		alert("请选择跑批的数据日期");
	}else{
		showMask();	 
	
	$.get("../build_batch/dishuibatch", {
		datatime:datatime
	}, function(json) {
		hideMask();
		if(json){
			alert("转换成功");
		}
		else
			alert("转换失败");
	});
	
	}
}
function showMask(){     
    $("#mask").show();     
}  

function hideMask(){     
    $("#mask").hide();     
}  
function cannel(){
	$('#imgfile').empty();
	//$("#s_reportdate").val('');
}	
	
</script>
</html>
